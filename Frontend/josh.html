
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

    <title>Paw Print</title>
    <!-- Include necessary CSS files here -->
    <style>
        body {
            font-family: 'Roboto', Times, serif;
            background-color: #e6ccd2;
            margin: 0;
            padding: 0;
            padding-top: 120px; /* Adjust according to header height (100px) plus extra padding */
        }
        
        /* Style for the header */
        header {
            background-color: #800020;
            color: #ffffff;
            position: fixed;
            font-family: 'Roboto', Times, serif;
            width: 100%; /* Set width to 100% */
            margin: 0; /* Remove default margin */
            padding: 10px; /* Added padding */
            top: 0;
            left: 0;
            height: 120px;
            box-sizing: border-box;
            text-align: center; /* Align the content inside header to center */
        } 
    
        h1 {
        color: #FFFFFF;
        } 
    
        h2 {
        color: black;
        }  

        #mainTitle {
            font-size: 2em;
            margin-top: 20px;
        }

        #petInfoTitle {
            text-align: left; /* left-align the "Pet Information" title */
            font-size: 2em;
            margin-top: 20px;
        }

        /* Style for the different sections */
        .section {
    	display: none;
    	padding: 20px;
    	margin-top: 20px;
    	font-family: 'Roboto', Times, serif;
    	background-color: #e6ccd2;
	}

	.section.active {
   	 display: block;
	}

        .section-left {
            width: 50%; /* Left half of the screen */
            float: left;
            box-sizing: border-box;
            padding-right: 20px; /* Add some space between text and image */
        }

        .section-right {
            width: 50%; /* Right half of the screen */
            float: left;
            box-sizing: border-box;
        }

        /* Style for the navigation links */
        nav ul {
            list-style-type: none;
            padding: 0;
            margin-bottom: 20px; /* Add margin to push the links up */
            color: #ffffff;
            display: inline; /* Set list items to display inline */
        }

        nav ul li {
            display: inline; /* Display list items inline */
            color: #ffffff;
            margin-right: 20px;
            padding-bottom: 20px; /* Add padding to the bottom */
        }

        nav ul li a {
            text-decoration: none; /* Remove underline */
            color: #ffffff; /* Set color */
            font-weight: bold; /* Make the text bold */
            font-size: 16px; /* Set font size */
        }

        nav ul li a:hover {
            color: #555; /* Change color on hover */
        }

        footer {
            background-color: #800020; /* Set background color */
            color: #ffffff; /* Set text color */
            padding: 20px 0; /* Added padding top and bottom */
            text-align: center;
            width: 100%; /* Set width to 100% */
            position: fixed; /* Fix the footer at the bottom */
            bottom: 0; /* Align to the bottom of the viewport */
        }

        footer p {
            margin: 0; /* Remove default margin */
        }   

	.container {
   	 display: flex;
	}

	.chart-container {
   	 flex: 1; /* Take up the left half of the container */
	}

	.api-data-container {
    	flex: 1; /* Take up the right half of the container */
    	padding-left: 20px; /* Add some space between the chart and the API data */
	}

	/* Adjustments to make the chart and API data divs look nice */
	#chartContainer {
    	margin-top: 20px; /* Add space above the chart */
	}

	#apiData {
    	background-color: #f9f9f9;
    	padding: 20px;
    	border-radius: 5px;
	}    
    </style>
</head>
<body> 

<header>
    <h1 id="mainTitle">Paw Print</h1>
    <!-- Navigation or other header content can be added here -->
    <nav>
    <ul id="navLinks">
        <li><a href="#" onclick="showSection('home')">Home</a></li>
        <li><a href="#" onclick="showSection('about')">About Us</a></li>
        <li><a href="#" onclick="showSection('product')">Buy the Paw Print Palace</a></li>
        <li><a href="#" onclick="showSection('register')">Register a Pet</a></li>
        <li><a href="#" onclick="showSection('chart')">Monitor your Pet</a></li>
    </ul>
</nav>
</header>

<div id="chart" class="section">
    <div class="container">
        <div class="chart-container">
            <h2>Log In | Monitor Your Pet</h2>
            <div id="authForm">
                <label for="authUsername">Username:</label>
                <input type="text" id="authUsername" name="authUsername"><br><br>
                <label for="authPassword">Password:</label>
                <input type="password" id="authPassword" name="authPassword"><br><br>
                <button type="button" onclick="authenticateUser()">Login</button>
                <button type="reset" onclick="resetLogin()">Reset</button>
            </div>
            <div id="chartContainer" style="display:none;">
                <!-- Chart will be rendered here -->
                <canvas id="myChart"></canvas>
            </div>
        </div>
        <div id="apiDataContainer" class="api-data-container" style="display:none;">
            <!-- Div for displaying data from Flask API -->
		<p id="dietAdvice">Waiting for data...</p>
            <div id="apiData"></div>
        </div>
    </div>
</div>

<div id="home" class="section active">
    <div class="section-left">
        <h2>Welcome to Paw Print!</h2>
        <p>Elevate your pet's dining experience with our automatic feeders â€“ reliable, convenient, and tailored to their needs. Say hello to hassle-free feeding and goodbye to mealtime worries!</p>
    </div>
    <div class="section-right">
        <!-- Insert your image here -->
        <img src="logo.png" alt="Paw Print Logo" style="width: 60%; height: 60%;">
    </div>
</div>

<div id="register" class="section">
    <h2>Register a Pet</h2>
    <form id="registerForm">
        <label for="username">Username:</label>
        <input type="text" id="username" name="username"><br><br>
        <label for="password">Password:</label>
        <input type="password" id="password" name="password"><br><br>
        <label for="petName">Pet Name:</label>
        <input type="text" id="petName" name="petName"><br><br>
        <label for="petCurrentWeight">Pet Weight:</label>
        <input type="text" id="petCurrentWeight" name="petCurrentWeight"><br><br>
        <label for="petTargetWeight">Pet Target Weight:</label>
        <input type="text" id="petTargetWeight" name="petTargetWeight"><br><br>
        <!-- Include other input fields for pet information -->
        <button type="submit">Submit</button>
        <button type="reset" onclick="resetForm()">Reset</button>
    </form>
</div>

<div id="about" class="section">
    <h2>About Us</h2>
    <img src="about_us.jpg" alt="About Us Image" style="width: 20%; height: 20%;">
    <p>Paw Print is made up of 6 members: Danny, Sam, Glen, Josh, Fares, and Keya. We are all NC State Engineering students and working within the Engineering Entrepreneurship Program (EEP) to collaboratively create our own business. We combine our technical expertise with the business experience of the EEP faculty to generate a product with the potential to establish itself in the market.</p>
    <p>Paw Print strives to create products that keep our furry friends as healthy and happy as possible. We all love our pets but it is hard to keep track of what is going on with them at all times. By recreating the technology we use to track our own health, we can apply them to products our pets use every day. The sensors in every product communicate with our proprietary software to provide meaningful and relevant information to the user.</p>
</div>

<div id="product" class="section">
    <h2>Health-Oriented Automatic Feeder</h2>
    <p>Our health-oriented automatic feeder is designed to track the food and water consumption of pets, ensuring they maintain a healthy diet and hydration level. It features:</p>
    <ul>
        <li>Automatic portion control based on pet's weight and dietary needs.</li>
        <li>Real-time monitoring of food and water intake via our website.</li>
        <li>Customizable feeding schedules and notifications.</li>
        <li>Easy-to-clean and durable design.</li>
    </ul>

    <h2>Shipping Address</h2>
    <form id="shippingForm">
        <label for="fullName">Full Name:</label>
        <input type="text" id="fullName" name="fullName"><br><br>
        <label for="address">Address:</label>
        <input type="text" id="address" name="address"><br><br>
        <label for="city">City:</label>
        <input type="text" id="city" name="city"><br><br>
        <label for="state">State:</label>
        <input type="text" id="state" name="state"><br><br>
        <label for="zip">ZIP Code:</label>
        <input type="text" id="zip" name="zip"><br><br>
    </form>

    <h2>Payment Information</h2>
    <form id="paymentForm">
        <label for="nameOnCard">Name on Card:</label> <!-- Added input for name on card -->
        <input type="text" id="nameOnCard" name="nameOnCard"><br><br> <!-- Added input for name on card -->
        <label for="cardNumber">Card Number:</label>
        <input type="text" id="cardNumber" name="cardNumber"><br><br>
        <label for="expiryDate">Expiry Date:</label>
        <input type="text" id="expiryDate" name="expiryDate"><br><br>
        <label for="cvv">CVV:</label>
        <input type="text" id="cvv" name="cvv"><br><br>
        <button type="submit" onclick="submitOrder();alert('Thank you for your order!')">Place Order</button>
    </form>
</div>

    <!-- Footer -->
    <footer>
        <p>Contact us at: PawPrint.EEP@gmail.com</p>
    </footer>
	
<!-- Include Chart.js library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    function showSection(sectionId) {
    // Hide all sections
    const sections = document.getElementsByClassName('section');
    for (let i = 0; i < sections.length; i++) {
        sections[i].classList.remove('active');
    }

    // Show the selected section
    const selectedSection = document.getElementById(sectionId);
    selectedSection.classList.add('active');

    // If the selected section is not the "Home" section, hide the "Home" section
    if (sectionId !== 'home') {
        document.getElementById('home').classList.remove('active');
    }
}

 ////////////////////REGISTRATION FUNCTIONS////////////////////////
 document.getElementById('registerForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent the default form submission behavior
    registerUser();
});

function registerUser() {
    // Collect data from the form
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const petName = document.getElementById('petName').value;
    const petCurrentWeight = document.getElementById('petCurrentWeight').value;
    const petTargetWeight = document.getElementById('petTargetWeight').value;

    // Optionally store data in localStorage (be cautious about storing sensitive data like passwords)
    localStorage.setItem('username', username);
    localStorage.setItem('password', password); // Note: Storing passwords in localStorage is not recommended
    localStorage.setItem('petName', petName);
    localStorage.setItem('petCurrentWeight', petCurrentWeight);
    localStorage.setItem('petTargetWeight', petTargetWeight);

    // Prepare data to be sent in a FormData object
    var formData = new FormData();
    formData.append('username', username);
    formData.append('password', password);
    formData.append('petName', petName);
    formData.append('petCurrentWeight', petCurrentWeight);
    formData.append('petTargetWeight', petTargetWeight);

    // Perform the fetch request
    fetch('http://127.0.0.1:5000/register', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok: ' + response.statusText);
        }
        return response.json(); // This returns a promise that resolves with the result of parsing the body text as JSON
    })
    .then(data => {
        console.log('Received data:', data);
        console.log('Registration successful:', data);
        alert('Thank you for registering with Paw Print!');
        updateDietRecommendations();
    })
    .catch(error => {
        console.error('Registration failed due to:', error);
        alert('Registration failed due to: ' + error.message); // Display the error message to the user
    });
}

function resetRegister() {
    document.getElementById('username').value = '';
    document.getElementById('password').value = '';
    document.getElementById('petName').value = '';
    document.getElementById('petCurrentWeight').value = '';
    document.getElementById('petTargetWeight').value = '';
}

 //////////////AUTHENTICATION FUNCTIONS////////////////

document.getElementById('authForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Prevent the default form submission behavior
    authenticateUser();
});

function authenticateUser() {
    const authUsername = document.getElementById('authUsername').value;
    const authPassword = document.getElementById('authPassword').value;

    // Storing in localStorage (not recommended for sensitive data)
    localStorage.setItem('authUsername', authUsername);
    localStorage.setItem('authPassword', authPassword);

    // Prepare data to be sent in a FormData object
    var formData = new FormData();
    formData.append('authUsername', authUsername);
    formData.append('authPassword', authPassword);

    // Perform the fetch request
    fetch('http://127.0.0.1:5000/login_endpoint', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Server responded with a non-200 status: ' + response.statusText);
        }
        return response.json(); // Parse the JSON in the response
    })
    .then(data => {
        console.log('Login successful:', data);
        alert('You are logged in!'); // Alert the user upon successful login
        // Additional actions based on response, like showing the chart and API data container
        document.getElementById('chartContainer').style.display = 'block';
        document.getElementById('apiDataContainer').style.display = 'block';
    })
    .catch(error => {
        console.error('Login failed:', error);
        alert('Login failed. Please try again. ' + error.message); // Provide error message for better debugging feedback
    });

    resetLogin();
}

function resetLogin() {
    document.getElementById('authUsername').value = '';
    document.getElementById('authPassword').value = '';
}

///////////////////// DIETARY FUNCTIONS ///////////////////////////
function updateDietRecommendations() {
    fetch('http://127.0.0.1:5000/calculate_intake', {
        method: 'GET'
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok'); // This will handle HTTP errors more explicitly
        }
        return response.json(); // Parse JSON only if the response was successful
    })
    .then(data => {
        if (data.message) {
            document.getElementById('dietAdvice').textContent = data.message;
            console.log('Message received:', data.message); // Log the message received from the server
        } else {
            document.getElementById('dietAdvice').textContent = 'Error fetching data.';
        }
    })
    .catch(error => {
        document.getElementById('dietAdvice').textContent = 'Network or server error.';
        console.error('Error:', error);
    });
}
    
    function validateShippingAddress() {
    const fullName = document.getElementById('fullName').value.trim();
    const address = document.getElementById('address').value.trim();
    const city = document.getElementById('city').value.trim();
    const state = document.getElementById('state').value.trim();
    const zip = document.getElementById('zip').value.trim();

    if (fullName === '' || address === '' || city === '' || state === '' || zip === '') {
        alert('Please fill out all required fields for shipping address.');
        return false;
    }

    // Check ZIP code format (5 digits)
    const zipRegex = /^\d{5}$/;
    if (!zipRegex.test(zip)) {
        alert('Please enter a valid ZIP code.');
        return false;
    }

    // You can add additional checks for ZIP code and state validation using external APIs or databases
    
    return true;
    }

    function validatePaymentInfo() {
        const cardNumber = document.getElementById('cardNumber').value.trim();
        const nameOnCard = document.getElementById('nameOnCard').value.trim();
        const expiryDate = document.getElementById('expiryDate').value.trim();
        const cvv = document.getElementById('cvv').value.trim();

    if (cardNumber === '' || nameOnCard === '' || expiryDate === '' || cvv === '') {
        alert('Please fill out all required fields for payment information.');
        return false;
    }

    // Check if card number is valid
    const cardNumberRegex = /^\d{16}$/; // Simple check for 16 digits
    if (!cardNumberRegex.test(cardNumber)) {
        alert('Please enter a valid card number.');
        return false;
    }

    // Validate expiry date format (MM/YY)
    const expiryDateRegex = /^(0[1-9]|1[0-2])\/\d{2}$/;
    if (!expiryDateRegex.test(expiryDate)) {
        alert('Please enter a valid expiry date (MM/YY).');
        return false;
    }

    // Check if expiry date is not in the past
    const [month, year] = expiryDate.split('/');
    const currentDate = new Date();
    const currentYear = currentDate.getFullYear() % 100; // Extract last 2 digits of the year
    const currentMonth = currentDate.getMonth() + 1; // Month is zero-based
    if (parseInt(year) < currentYear || (parseInt(year) === currentYear && parseInt(month) < currentMonth)) {
        alert('Please enter a valid expiry date (not in the past).');
        return false;
    }

    // Check if CVV is valid (3 or 4 digits)
    const cvvRegex = /^\d{3,4}$/;
    if (!cvvRegex.test(cvv)) {
        alert('Please enter a valid CVV.');
        return false;
    }

    return true;
    }

    function submitOrder() {
    if (validateShippingAddress() && validatePaymentInfo()) {
        // Proceed with order submission
        alert('Order submitted successfully!');
        }
    }


    function resetForm() {
        document.getElementById('petName').value = ''; // Clear the pet name input field
        document.getElementById('petCurrentWeight').value = ''; // Clear the pet current weight input field
        document.getElementById('petTargetWeight').value = ''; // Clear the pet target weight input field

	// Clear input fields in the shipping address section
        document.getElementById('fullName').value = '';
        document.getElementById('address').value = '';
        document.getElementById('city').value = '';
        document.getElementById('state').value = '';
        document.getElementById('zip').value = '';

        // Clear input fields in the payment information section
        document.getElementById('cardNumber').value = '';
        document.getElementById('expiryDate').value = '';
        document.getElementById('cvv').value = '';
    }

    function renderChart() {
    fetch('http://127.0.0.1:5000/chart_endpoint')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (!data.petData) {
                throw new Error('No pet data available');
            }

            const petData = data.petData;
            const timesInSeconds = petData.map(entry => entry.timeInSeconds);
            const foodData = petData.map(entry => entry.foodEaten);
            const waterData = petData.map(entry => entry.waterDrank);

            const ctx = document.getElementById('myChart').getContext('2d');
            if (window.petDataChart) {
                // Update chart if it already exists
                window.petDataChart.data.labels = timesInSeconds;
                window.petDataChart.data.datasets[0].data = foodData;
                window.petDataChart.data.datasets[1].data = waterData;
                window.petDataChart.update();
            } else {
                // Create a new chart instance if it doesn't exist
                window.petDataChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: timesInSeconds,
                        datasets: [{
                            label: 'Food Eaten',
                            data: foodData,
                            borderColor: 'blue',
                            backgroundColor: 'rgba(0, 0, 255, 0.1)',
                            borderWidth: 1
                        }, {
                            label: 'Water Drank',
                            data: waterData,
                            borderColor: 'green',
                            backgroundColor: 'rgba(0, 255, 0, 0.1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            x: {
                                type: 'linear',
                                title: {
                                    display: true,
                                    text: 'Time (seconds)'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Amount'
                                }
                            }
                        }
                    }
                });
            }
        })
        .catch(error => {
            console.error('Fetch error:', error);
            document.getElementById('petDataChart').textContent = 'Failed to load chart data.';
        });
    }

        // Call renderChart initially
        renderChart();

        // Update chart every 5 seconds (adjust as needed)
        setInterval(renderChart, 5000);

</script>
</body>
</html>
